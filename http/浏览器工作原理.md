# 浏览器工作原理

浏览器是运行在操作系统上面的应用程序

## 进程与线程

进程是操作系统进行资源分配和调度的基本单元，可以申请和拥有计算机资源，进程是程序的基本执行实体。

线程是操作系统能够进行运算调度的最小单元，一个进程中可以并发多个线程，每条线程并行执行不同的任务

一个进程对应会存储在内存空间，如果两个进程间需要通信，则会通过通信管道IPC进行通信

## 浏览器的结构

- 浏览器进程

负责控制浏览器除标签页外的用户界面，如地址栏、书签、后腿和前进按钮，以及负责与浏览器的其它进程协调工作

- 缓存进程

- 网络进程

负责发起接受网络请求

- GPU进程

负责整个浏览器界面的渲染

- 插件进程

负责控制网站使用的所有插件

- 渲染器进程

负责控制显示tab标签内的所有内容，浏览器默认情况下会给每个标签页创建一个进程（与进程模型有关）

## 浏览器输入地址时，浏览器内部发生什么事

1. 浏览器的UI线程会捕捉你的输入内容

2. 如果访问的是网址，UI线程会启动一个网络线程来请求DNS进行域名解析，接着开始连接服务器获取数据，如果输入的不是网址而是关键词，浏览器会知道你是要搜索，于是就会使用默认配置的搜索引擎来查询

3. 网络线程获取到数据后会校验站点是否为恶意站点，如果是，则会提示是个警告页面，告诉用户这个站点是有安全问题，浏览器会阻止用户的访问，当然用户也可以强行继续访问，如果当数据通过安全校验时，这时网络线程会通知UI线程，可以继续下步操作了。

4. UI线程会创建一个渲染器进程来渲染页面，浏览器进程通过IPC管道将数据传递给渲染器进程，正式进入渲染流程。

5. 渲染器进程接收到数据（html）等资源渲染成用户可以交互的web页面，渲染器的主线程会将html进程解析，将DOM数据结构构造成DOM树，构造过程成会创建文档（document）对象

6. 主线程解析CSS并确定每个DOM节点的计算样式，得到DOM结构和每个节点的样式后，需要确定每个节点的坐标或者位置，这个阶段被称为Layout布局

7. 主线程通过遍历dom和计算好的样式来生成Layout Tree，Layout Tree每个节点都记录了x，y坐标和边框尺寸，DOM Tree和Layout Tree并不是一一对应的，如果DOM Tree有节点设置display:none;是不会出现在Layout Tree上面，而在::before伪类中设置了content值的元素，content的内容会出现在Layout Tree上，不会出现DOM Tree里面。

8. 主线程根据Layout Tree创建了绘制记录表，记录了绘制的顺序，这个阶段被称为绘制

9. 页面进行合成（合成是将页面的各个部分分成多个图层，然后分别对每个图层进行栅格化），并在合成器线程的技术中单独进行合成页面












