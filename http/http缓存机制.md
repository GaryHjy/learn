# HTTP缓存机制

当访问chrome中的URL时，页面上的HTML和其他资产（如图像）将本地存储在内存和磁盘缓存中。Chrome将首先使用内存缓存，因为它的速度快得多，但它也会将页面存储在磁盘缓存中，以防您退出浏览器或它崩溃，因为磁盘缓存是持久的。

## 分类

- 强缓存

**expires**

HTTP1.0规定的响应头，对应一个未来的时间戳。客户端第一次请求之后，服务端下发Expires响应头字段，当客户端再次需要请求时，先会对比当前时间和Expires头中设置的时间。如果当前时间早于Expires时间，那么直接使用缓存数据，反之则需要再次发送请求，更新数据。

```
expires: Sun, 02 Aug 2020 11:25:34 GMT
```

缺点：
  1. 可能会因为服务器和客户端的GMT时间不同，出现偏差
  2. 如果修改了本地时间，那么客户端日期可能不准确
  3. 写法太复杂，字符串多个空格，少个字母，都会导致非法属性从而设置失效

**cache-control**

HTTP1.1版本中，服务端使用Cache-control这个响应头，这个头部更加强大，它具有更多不同的值：
```
private: 表示私有缓存，不能被共有缓存代理服务器缓存，不能在用户共存，可被用户的浏览器缓存
public：表示共有缓存，可被代理服务器缓存，比如CDN，允许多用户间共享
max-age：值以秒为单位，表示缓存的内容会在该值后过期
no-cache：表示不进行强缓存验证, 而是用协商缓存来验证。
no-store：所有内容都不会被缓存
must-revalidate：告诉浏览器，你必须再次验证检查信息是否过期，返回的代号就不是200而是304了
```

```js
//Response Headers
Cache-Control: private, max-age=0, must-revalidate
// 表示该资源只能被浏览器缓存，而不能被代理缓存。max-age标识为0，说明该缓存资源立即过期，must-revalidate告诉浏览器，需要验证文件是否过期，接下来可能会使用协商缓存进行判断
```

**HTTP规定，如果Cache-control的max-age和Expires同时出现，那么max-age的优先级更高，他会默认覆盖掉expires**

- 协商缓存

过程：在浏览器端，当对某个资源的请求没有命中强缓存是，浏览器会发一个请求到服务器，验证协商缓存是否命中，如果协商缓存命中，请求响应返回的HTTP状态为304